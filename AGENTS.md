# Repository Guidelines

## Project Structure & Module Organization
- Source: `src/` — core extension code (`content.js`), UI (`popup.html`, `popup.js`, `popup.css`), `manifest.json`, icons in `src/icons/`.
- Safari project: `src/safari/Metric Imperial Converter/` — Xcode workspace generated by Apple’s converter.
- Tests: `test/**/*.test.js` — Jest + jsdom.
- Output: `dist/` — Chrome zip and Safari app builds.
- Coverage: `coverage/` — reports from `npm run test:coverage`.

## Build, Test, and Development Commands
- `npm install`: install dependencies (also sets up Husky via `prepare`).
- `npm test`: run all tests once.
- `npm run test:watch`: re-run tests on changes.
- `npm run test:coverage`: create coverage report.
- `npm run lint` | `npm run lint:fix`: check/fix lint issues.
- `npm run format`: Prettier write across the repo.
- `npm run build:chrome`: package Chrome extension to `dist/extension.zip`.
- `npm run init:safari`: generate Safari project in `src/safari/` (one-time).
- `npm run build:safari` then `npm run build:safari-app`: build Safari app to `dist/safari/`.
- `npm run build`: run all build steps.

## Coding Style & Naming Conventions
- Tools: ESLint (`eslint:recommended` + `prettier`) and Prettier; warnings for `no-console` and `no-unused-vars`.
- Indentation/formatting: Prettier defaults; run `npm run format` before commits.
- Naming: camelCase for functions/variables, UPPER_SNAKE_CASE for constants, filenames lowercase (e.g., `content.js`, `popup.js`).

## Testing Guidelines
- Framework: Jest with `jsdom` environment.
- Location/pattern: place tests under `test/` with `*.test.js` filenames.
- Coverage: keep or improve current coverage; run `npm run test:coverage`.
- DOM tests: build DOM via `document.body` and call exported helpers from `src/content.js`.

## Commit & Pull Request Guidelines
- Commits: imperative, concise subject; include context (e.g., “Convert gallons/quarts parsing”). Reference issues like `(#12)` when applicable.
- Pre-commit: Husky runs Prettier and lint-staged; if hooks are missing, run `npm run prepare`.
- PRs: include a clear description, linked issues, test updates, and screenshots or text samples showing before/after conversions. For Safari changes, note Xcode steps and target scheme.

## Security & Configuration Tips
- Keep `manifest.json` permissions minimal; avoid adding host or network permissions unless required.
- Respect the URL blacklist (`src/content.js`) so conversion avoids sensitive domains.
- Test on static pages and dynamic content to validate MutationObserver paths.

## GitHub CLI (gh)
- Setup: `brew install gh` then `gh auth login`.
- Issues: `gh issue list --state open`, view one with `gh issue view <number>`.
- PRs: create with `gh pr create --fill --base main --head <branch>`, check status via `gh pr status`.
- CI runs: `gh run list` and `gh run watch -i <run-id>` to follow checks.
